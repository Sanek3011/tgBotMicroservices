# Telegram Bot JFMC (Microservices Edition)

–ü—Ä–æ–µ–∫—Ç ‚Äî —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç, —Ä–∞—Å–ø–∏–ª–µ–Ω–Ω—ã–π –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã. –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —á–µ—Ä–µ–∑ **REST API** –∏ **Kafka**. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Liquibase**.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç, —Ä–∞–±–æ—Ç–∞—é—â–∏–π —á–µ—Ä–µ–∑ **Telegram Bot API**
* –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

  * **UserService** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω, –≤—ã–¥–∞—á–∞ JWT
  * **OrderService** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
  * **ReportService** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤—ã–¥–∞—á–∞ –æ—Ç—á—ë—Ç–æ–≤
  * **BFF (Backend for Frontend)** ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø–∞—Ä–∞–¥–∏–≥–º–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º webflux
  * **Telegram Gateway** ‚Äî —à–ª—é–∑ –º–µ–∂–¥—É Telegram –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ API
* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ **REST** (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) –∏ **Kafka** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
* **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ JWT
* **Liquibase** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∫–∞—Ç—ã–≤–∞–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º –ë–î

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)

```
[Telegram User]
      ‚îÇ
      ‚ñº
[Telegram Gateway] ‚áÑ [UserService] ‚áÑ [UserService-DB]
      ‚îÇ                     ‚îÇ
      ‚îÇ                     ‚îî‚îÄ‚îÄ JWT –≤—ã–¥–∞—á–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
      ‚îÇ
      ‚îú‚îÄ‚îÄ REST/kafka ‚Üí [OrderService] ‚áÑ [OrderService-DB]
      ‚îÇ
      ‚îú‚îÄ‚îÄ REST/kafka ‚Üí [ReportService] ‚áÑ [ReportService-DB]
   

[Frontend (BFF)] ‚áÑ REST/kafka ‚áÑ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* Java 21
* Spring Boot 3.5.3
* Spring Security (JWT)
* Spring Data JPA
* Spring WebFlux
* Thymeleaf
* Liquibase
* PostgreSQL
* Apache Kafka
* Docker, Docker Compose

---

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* JDK 17+
* Maven (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./mvnw`)
* Docker & Docker Compose
* Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ @BotFather)

---

## üì¶ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/Sanek3011/tgbotJFMC.git
cd tgbotJFMC
```

2. –°–æ–±—Ä–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã (–∏–ª–∏ —Å–æ–±–∏—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –∏—Ö –∫–∞—Ç–∞–ª–æ–≥–∞—Ö):

```bash
./mvnw clean package -DskipTests
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç–µ–∫ —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up --build -d
```

> –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ Liquibase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∫–∞—Ç–∞–µ—Ç —Å—Ö–µ–º—ã –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üìå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ‚Äî –æ–±—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã (—É–∫–∞–∑–∞–Ω—ã –≤ `docker-compose.yml`):

* `SPRING_DATASOURCE_URL` ‚Äî JDBC URL –ë–î
* `SPRING_DATASOURCE_USERNAME` / `SPRING_DATASOURCE_PASSWORD`
* `SPRING_KAFKA_BOOTSTRAP_SERVERS` ‚Äî –∞–¥—Ä–µ—Å Kafka
* `SECRET_TOKEN` / `JWT_SECRET` ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT (–æ–±—â–∏–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
* `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è telegram-gateway)
* –ö–ª—é—á–∏ (private and public) –ª–µ–∂–∞—Ç –∏ –∏—â—É—Ç—Å—è –≤ resource.

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

* –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç JWT.
* –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ REST-–∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
Authorization: Bearer <jwt-token>
```

### –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

* –î–ª—è internal-–≤—ã–∑–æ–≤–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT, –æ–±—â–∏–π –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ç–æ–∫–µ–Ω.
* –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –µ–≥–æ –≤ —Ç–æ–º –∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <service-jwt>`
* –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏—ë–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, `aud` / `iss` / `roles`.

---

## üß© Liquibase

* Changelog'–∏ –ª–µ–∂–∞—Ç –≤ `src/main/resources/db/changelog` –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
* –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Liquibase –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–π –ë–î.
* –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `databasechangelog`.

---

## üì° Kafka

* Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Üí —Å–æ–±—ã—Ç–∏–µ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –∏ —Ç.–ø.).
* –í `docker-compose.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã `zookeeper` –∏ `kafka`.
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–ø–∏–∫–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
.
‚îú‚îÄ‚îÄ telegram-gateway/   # —à–ª—é–∑ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API
‚îú‚îÄ‚îÄ userservice/        # —Å–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π + JWT
‚îú‚îÄ‚îÄ orderservice/       # —Å–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤
‚îú‚îÄ‚îÄ reportservice/      # —Å–µ—Ä–≤–∏—Å –æ—Ç—á—ë—Ç–æ–≤
‚îú‚îÄ‚îÄ bff/                # backend-for-frontend
‚îú‚îÄ‚îÄ docker-compose.yml  # –∑–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
‚îî‚îÄ‚îÄ README.md
```

–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è https://disk.yandex.ru/d/R5vbI_eyY6RlHQ
